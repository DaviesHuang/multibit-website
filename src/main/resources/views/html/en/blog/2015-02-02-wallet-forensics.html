<h1>Wallet forensics for issue #661</h1>

<p>Recently we had a user raise a github issue (<a href="https://github.com/jim618/multibit/issues/661">#661</a>) where unfortunately they lost a total of 1.43033675 bitcoin. This blog item is a write up on the forensics we did to find out what happened and our recommendations for action to try to prevent this happening again.</p>
</p>

<h2>What happened</h2>
<p>The wallet was created in April 2014 in MultiBit Classic. When first created a MultiBit Classic wallet has a single private key/ address. Any transactions created use this single address as change. When extra private keys are created or imported the second address in the wallet is always used for change. (This rule was introduced after a user imported a paper wallet and, not understanding the nature of change, subsequently manually deleted their MultiBit installation to "leave no trace".)</p>
<p>Examining the wallet structure closely it has a total of 580 private keys. Almost all of these have private keys that are random numbers - this is normal. However the second private key in the wallet corresponds to the private key (hex) of 0000000000000000000000000000000000000000000000000000000000000000. The third private key corresponds to the private key (hex) of 0000000000000000000000000000000000000000000000000000000000000001. These are obviously not random numbers.</p>
<p>In the MultiBit log we log when the user shows the "Tools | Import private key" screen but we do not log the actual private keys imported for privacy reasons. In our opinion by far the most likely way these specific private key values were inserted into the wallet is that the user was experimenting with the private key import capability in MultiBit.<p>
<p>This was in April 2014. Unfortunately having a change address with a private key of 0 makes bitcoin controlled by that address unspendable. This is due to a quirk in the Bitcoin protocol. The address for the private key is arithmetically correct but no acceptable signature can be created to transfer the bitcoin (see <a href="https://bitcointa.lk/threads/first-post-and-an-interesting-observation-about-ecdsa.148676/">this comment</a>). From April 2014 to Jan 2015 the user used his wallet to transfer bitcoin in and then almost immediately move the total amount (minus fee) out. For these transactions there was no change output and everything worked correctly.</p>
<p>From 15 Jan 2015 to 26 Jan 2015 the user made 8 transactions where change outputs were created and it is these outputs that are unspendable. They total 1.43033675 bitcoin in value.</p>
<h2>Recommendations for improvements</h2>
<p>Bitcoin is an experimental protocol so it is important to improve things wherever possible to make the system more robust and safer to use. We recommend the following actions are taken:</p>
<ol>
<li>The transfer of private keys from wallet to wallet is a powerful technique but it is a like a very sharp knife. We recommend that users do not transfer private keys from wallet to wallet (except for the recovery of backup private key export files created in MultiBit Classic). We will update the MultiBit Classic documention in line with this recommendation.</li>
<li>The MultiBit Classic import routine should be improved so that a private key of exactly 0000000000000000000000000000000000000000000000000000000000000000 is not added to the wallet should a user try to import this value.</li>
<li>The "Tools | Check private key" utility should be enhanced to highlight the exogenous fact that bitcoin controlled by this private key is not spendable.</li>
<li>In the medium term, users should be encouraged to move away from wallets that rely of purely random private keys and start using wallets that use deterministically generated private keys. Hierarchical deterministic wallets (HD wallets) have a set of wallet words that can be used to recreate all the private keys for a wallet. Various HD wallets are currently being developed and rolled out and we recommend users start evaluating using them.</li>
</ol>
<p>At MultiBit we work hard to provide users with a safe, open source Bitcoin wallet and hate it when users run into problems like this. These recommendations we believe will improve the overall robustness of Bitcoin wallets for everyone.</p>